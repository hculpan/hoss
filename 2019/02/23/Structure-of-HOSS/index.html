<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/hoss/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/hoss/css/main.css?v=7.0.1">


  <link rel="apple-touch-icon" sizes="180x180" href="/hoss/images/apple-touch-icon-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="32x32" href="/hoss/images/favicon-32x32-next.png?v=7.0.1">


  <link rel="icon" type="image/png" sizes="16x16" href="/hoss/images/favicon-16x16-next.png?v=7.0.1">


  <link rel="mask-icon" href="/hoss/images/logo.svg?v=7.0.1" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/hoss/',
    scheme: 'Gemini',
    version: '7.0.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false,"dimmer":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="As I mentioned in my first post, HOSS is so far very heavily based on two different tutorials.  As a result, my structure largely matches that given in both of these, particularly Fenollosa’s.   My bo">
<meta property="og:type" content="article">
<meta property="og:title" content="Structure of HOSS">
<meta property="og:url" content="http://hculpan.github.io/hoss/2019/02/23/Structure-of-HOSS/index.html">
<meta property="og:site_name" content="HOSS">
<meta property="og:description" content="As I mentioned in my first post, HOSS is so far very heavily based on two different tutorials.  As a result, my structure largely matches that given in both of these, particularly Fenollosa’s.   My bo">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://hculpan.github.io/hoss/2019/02/23/Structure-of-HOSS/images/dir_structure_1.png">
<meta property="og:updated_time" content="2019-03-01T15:15:33.571Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Structure of HOSS">
<meta name="twitter:description" content="As I mentioned in my first post, HOSS is so far very heavily based on two different tutorials.  As a result, my structure largely matches that given in both of these, particularly Fenollosa’s.   My bo">
<meta name="twitter:image" content="http://hculpan.github.io/hoss/2019/02/23/Structure-of-HOSS/images/dir_structure_1.png">






  <link rel="canonical" href="http://hculpan.github.io/hoss/2019/02/23/Structure-of-HOSS/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Structure of HOSS | HOSS</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/hoss/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">HOSS</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Harry's Operating System Software</p>
      
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    

    <a href="/hoss/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/hoss/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://hculpan.github.io/hoss/hoss/2019/02/23/Structure-of-HOSS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Harry Culpan">
      <meta itemprop="description" content="This is a blog about my efforts to write a 32-bit operating system">
      <meta itemprop="image" content="/hoss/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="HOSS">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Structure of HOSS

              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-23 12:04:02" itemprop="dateCreated datePublished" datetime="2019-02-23T12:04:02-05:00">2019-02-23</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-03-01 10:15:33" itemprop="dateModified" datetime="2019-03-01T10:15:33-05:00">2019-03-01</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p><img src="images/dir_structure_1.png" alt><br>As I mentioned in my first post, HOSS is so far very heavily based on two different tutorials.  As a result, my structure largely matches that given in both of these, particularly Fenollosa’s.  </p>
<p>My boot loader can be found in the /boot subdirectory.  I largely followed Blundell’s tutorial here, with the main code being in boot_sect.asm.  As the extensions suggests, it is written in assembly and is assembled using NASM.  The other files here are just included in the main file, so they will not produce their own object files and thus don’t have to be linked.  One change I made from Blundell’s code is that I named the 16-bit print string procedure print_string_16, and the 32-bit version is just print_string.  At the time I was doing it, I thought I would be using the 32-bit version more, but of course once I boot, I start using the version developed in C (see screen.c in /drivers).</p>
<p>The boot process works as follows:</p>
<ol>
<li>Basic 16-bit setup stuff (e.g., setup stack, print initial message).</li>
<li>Load next 15 sectors from disk into memory at 0x1000.  This loads the rest of our kernel.  This is just a very simple kernel loader.  It doesn’t know anything about a file system or anything like that.  It just takes all the bytes from the 15 sectors after the first and puts them in memory.  If there aren’t actually 15 sectors (which there aren’t when building just the basic os-image), it just loads as much as it finds.</li>
<li>Create simple GDT structurs.  This is a flat structure that creates one Data and one Code segment, and both map to the same memory.</li>
<li>Switch to protected mode.</li>
<li>Call the kernel entry point, which was loaded in step 2 to memory address 0x1000.</li>
</ol>
<p>Once the boot process has completed, the boot loader will hand off control to the kernel, starting with the kernel_main function in kernel/kernel.c.  When the kernel is built, it is compiled to start at an offset of 0x1000 because that’s where the kernel is loaded by the boot process.  And it is compiled without linking any libraries from the development platform.  Thus everything has to be written from scratch without reusing any libraries that one would normally have available with C.  The kernel has it’s process:</p>
<ol>
<li>Print out a message so I know it’s started (the kernel equivalent of “Hello, world!”)</li>
<li>Setup the IDT and the ISR’s.  To be honest, this is probably the one area of the boot/kernel that I am fuzziest on, at so far.  I understand the basic idea of an interrupt and that you need a routine to handle each interrupt.  As I understand the process, the Interrupt Descriptor Table (IDT) is a structure that basically informs the cpu what Interrupt Service Routine (ISR) to call for each interrupt.  Most call the same ISR, a generic routine that just prints out a message.  This is primarily for error interrupts (e.g., invalid opcode or general protection fault) that will never happen because my code never has bugs! :)  Obviously at some point, I’ll need ISR’s to better handle these situations, but for the moment this will do.  The only other important thing that happens here is that I setup an ISR for the timer and the keyboard.  I’ll discuss more about the keyboard in a subsequent post.  As you might imagine, the code for the IDT and ISR configuration comes almost completely unchanged from Blundell.</li>
<li>A simple test loop that takes keyboard input and echoes it out to the screen.  This will be the beginning of my command shell, but for now it’s in kernel.c.  This routine allows me to test out the screen and keyboard device drivers, which is what I’ll discuss next.</li>
</ol>

      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/hoss/2019/02/21/First-Post/" rel="next" title="Introduction to HOSS">
                <i class="fa fa-chevron-left"></i> Introduction to HOSS
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/hoss/2019/02/24/The-Screen-Device/" rel="prev" title="The Screen Device">
                The Screen Device <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Harry Culpan</p>
              <p class="site-description motion-element" itemprop="description">This is a blog about my efforts to write a 32-bit operating system</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/hoss/archives/">
                
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/hculpan" title="GitHub &rarr; https://github.com/hculpan" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="mailto:harry@culpan.org" title="E-Mail &rarr; mailto:harry@culpan.org" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Harry Culpan</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.0.1</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/hoss/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/hoss/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/hoss/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/hoss/js/src/utils.js?v=7.0.1"></script>

  <script src="/hoss/js/src/motion.js?v=7.0.1"></script>



  
  


  <script src="/hoss/js/src/affix.js?v=7.0.1"></script>

  <script src="/hoss/js/src/schemes/pisces.js?v=7.0.1"></script>




  
  <script src="/hoss/js/src/scrollspy.js?v=7.0.1"></script>
<script src="/hoss/js/src/post-details.js?v=7.0.1"></script>



  


  <script src="/hoss/js/src/bootstrap.js?v=7.0.1"></script>


  
  


  


  




  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
